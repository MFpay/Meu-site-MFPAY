<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MF-COLLECT | Sistema Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background: #0b0e11; color: #fff; font-family: 'Inter', sans-serif; }
        .glass-header { background: rgba(22, 26, 30, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .chat-box { height: 150px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 15px; padding: 10px; }
        .btn-green { background: #00e38c; color: #000; font-weight: 900; }
    </style>
</head>
<body class="pb-24">

    <nav class="glass-header sticky top-0 z-50 p-5 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="p-2 bg-[#00e38c] rounded-lg"><i data-lucide="layers" class="text-black w-5 h-5"></i></div>
            <h1 class="text-xl font-black italic">MF-COLLECT</h1>
        </div>
        <div class="text-right">
            <p class="text-[9px] font-bold text-zinc-500 uppercase">Saldo</p>
            <h2 id="saldo-txt" class="text-lg font-black text-[#00e38c]">R$ 0,00</h2>
        </div>
    </nav>

    <main class="p-6 max-w-xl mx-auto">
        <div class="bg-[#161a1e] rounded-[32px] p-8 text-center border border-white/5 mb-6">
            <span class="text-[10px] bg-[#00e38c]/10 text-[#00e38c] px-3 py-1 rounded-full font-bold uppercase">Temporada 01</span>
            <h2 class="text-3xl font-black italic mt-4 uppercase">Pack Lendário</h2>
            <p class="text-zinc-500 text-xs mt-2 mb-8">Chance de 5% de itens raros</p>
            <button onclick="abrirPack()" id="btn-pack" class="btn-green w-full py-5 rounded-2xl shadow-xl shadow-[#00e38c]/20 uppercase italic">Abrir Pack (R$ 5,00)</button>
        </div>

        <div class="bg-[#161a1e] p-5 rounded-[24px] border border-white/5 mb-6">
            <h3 class="text-[10px] font-bold uppercase text-zinc-500 mb-3">Comunidade</h3>
            <div id="chat" class="chat-box text-xs mb-3 space-y-2"></div>
            <div class="flex gap-2">
                <input id="chat-in" type="text" placeholder="Diz algo..." class="flex-1 bg-black border border-white/10 rounded-xl p-3 text-xs outline-none">
                <button onclick="enviarMsg()" class="bg-[#00e38c] text-black p-3 rounded-xl"><i data-lucide="send" class="w-4 h-4"></i></button>
            </div>
        </div>

        <h3 class="text-sm font-black italic uppercase mb-4">Minha Coleção</h3>
        <div id="colecao" class="grid grid-cols-2 gap-4"></div>
    </main>

<script>
    // LINKS DO TEU BANCO
    const DB_URL = "https://api.jsonbin.io/v3/b/65cd2a96dc74654018b36873";
    const KEY = "$2a$10$ExemploChaveMestreMFPAY2026";
    const user = localStorage.getItem('mf_user');

    if (!user) window.location.href = 'login.html';

    // FUNÇÃO QUE NÃO DEIXA A TELA FICAR PRETA
    async function carregarTudo() {
        try {
            const res = await fetch(DB_URL, { headers: { "X-Master-Key": KEY } });
            const data = await res.json();
            const db = data.record;

            const p = db.usuarios[user] || { saldo: 0, cartas: [] };
            document.getElementById('saldo-txt').innerText = `R$ ${p.saldo.toFixed(2)}`;

            // Renderizar Cartas
            const col = document.getElementById('colecao');
            col.innerHTML = p.cartas.map(c => `<div class="bg-[#161a1e] p-4 rounded-2xl border border-white/5 text-center text-[10px] font-bold uppercase italic">${c}</div>`).join('');

            // Renderizar Chat
            const chat = document.getElementById('chat');
            chat.innerHTML = (db.mensagens || []).map(m => `<div><b class="text-[#00e38c]">${m.user.split('@')[0]}:</b> ${m.texto}</div>`).join('');
            chat.scrollTop = chat.scrollHeight;

        } catch (e) {
            console.log("Erro ao carregar banco, tentando novamente...");
        }
        lucide.createIcons();
    }

    async function abrirPack() {
        const btn = document.getElementById('btn-pack');
        btn.disabled = true; btn.innerText = "SORTEANDO...";

        const res = await fetch(DB_URL, { headers: { "X-Master-Key": KEY } });
        const data = await res.json();
        let db = data.record;

        if (db.usuarios[user].saldo < 5) {
            alert("Saldo insuficiente!");
        } else {
            const itens = ["Comum", "Raro", "Lendário"];
            const item = itens[Math.floor(Math.random() * itens.length)];
            db.usuarios[user].saldo -= 5;
            db.usuarios[user].cartas.push(item);
            db.mensagens.push({ user: "SISTEMA", texto: `${user.split('@')[0]} tirou um ${item}!` });

            await fetch(DB_URL, {
                method: 'PUT',
                headers: { "Content-Type": "application/json", "X-Master-Key": KEY },
                body: JSON.stringify(db)
            });
            carregarTudo();
        }
        btn.disabled = false; btn.innerText = "Abrir Pack (R$ 5,00)";
    }

    async function enviarMsg() {
        const input = document.getElementById('chat-in');
        if (!input.value) return;
        
        const res = await fetch(DB_URL, { headers: { "X-Master-Key": KEY } });
        const data = await res.json();
        let db = data.record;

        db.mensagens.push({ user: user, texto: input.value });
        if (db.mensagens.length > 15) db.mensagens.shift();

        await fetch(DB_URL, {
            method: 'PUT',
            headers: { "Content-Type": "application/json", "X-Master-Key": KEY },
            body: JSON.stringify(db)
        });
        input.value = "";
        carregarTudo();
    }

    // Inicializa
    carregarTudo();
    lucide.createIcons();
    setInterval(carregarTudo, 8000); // Atualiza sozinho a cada 8 segundos
</script>
</body>
</html>
