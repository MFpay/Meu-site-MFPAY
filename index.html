<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MF-COLLECT | Global Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background: #0b0e11; color: #fff; font-family: 'Inter', sans-serif; }
        .chat-box { height: 180px; overflow-y: auto; background: rgba(0,0,0,0.4); border-radius: 20px; padding: 15px; }
        .msg-item { background: rgba(255,255,255,0.03); padding: 8px 12px; border-radius: 12px; margin-bottom: 8px; border-left: 3px solid #00e38c; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #00e38c; border-radius: 10px; }
    </style>
</head>
<body class="pb-24">
    <div id="app"></div>

<script>
    // ENDEREÃ‡O DO SEU BANCO DE DADOS NA NUVEM
    const CLOUD_DB_URL = "https://api.jsonbin.io/v3/b/65cd2a96dc74654018b36873"; 
    const MASTER_KEY = "$2a$10$ExemploChaveMestreMFPAY2026"; 
    const userLogado = localStorage.getItem('mf_user');

    if (!userLogado) window.location.href = 'login.html';

    async function fetchDB() {
        const res = await fetch(CLOUD_DB_URL, { headers: { "X-Master-Key": MASTER_KEY } });
        const json = await res.json(); return json.record;
    }

    async function saveDB(data) {
        await fetch(CLOUD_DB_URL, {
            method: 'PUT', headers: { "Content-Type": "application/json", "X-Master-Key": MASTER_KEY },
            body: JSON.stringify(data)
        });
    }

    async function render() {
        const db = await fetchDB();
        if (!db.usuarios[userLogado]) db.usuarios[userLogado] = { saldo: 0, cartas: [] };
        const player = db.usuarios[userLogado];
        const mensagens = db.mensagens || [];

        document.getElementById('app').innerHTML = `
            <div class="p-6 max-w-xl mx-auto">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-2xl font-black italic">MF<span class="text-[#00e38c]">CLOUD</span></h1>
                    <div class="text-right">
                        <p class="text-[9px] font-bold text-zinc-500 uppercase">Saldo Cloud</p>
                        <h2 class="text-xl font-black text-[#00e38c]">R$ ${player.saldo.toFixed(2)}</h2>
                    </div>
                </div>

                <div class="bg-[#161a1e] p-5 rounded-[30px] border border-white/5 mb-8">
                    <h3 class="text-[10px] font-black uppercase text-[#00e38c] mb-3">Chat da Comunidade</h3>
                    <div class="chat-box mb-4" id="chat-container">
                        ${mensagens.map(m => `<div class="msg-item"><span class="text-[#00e38c] font-black text-[9px] uppercase">${m.user.split('@')[0]}</span><p class="text-xs text-zinc-300">${m.texto}</p></div>`).join('')}
                    </div>
                    <div class="flex gap-2">
                        <input id="msg-input" type="text" placeholder="Escreva aqui..." class="flex-1 p-3 bg-black rounded-xl border border-white/10 text-xs outline-none">
                        <button onclick="enviarMsg()" class="bg-[#00e38c] text-black p-3 rounded-xl"><i data-lucide="send" class="w-4 h-4"></i></button>
                    </div>
                </div>

                <button onclick="abrirPack()" class="w-full py-8 bg-[#161a1e] border-2 border-[#00e38c]/20 rounded-[40px] mb-8 hover:border-[#00e38c] transition group">
                    <span class="block text-2xl font-black italic uppercase group-hover:scale-110 transition">Abrir Pack (R$ 5,00)</span>
                </button>

                <h3 class="text-[10px] font-black text-zinc-600 uppercase mb-4 tracking-widest text-center">ColeÃ§Ã£o Permanente</h3>
                <div class="grid grid-cols-2 gap-4">
                    ${player.cartas.map(c => `<div class="bg-[#161a1e] p-4 rounded-2xl border border-white/5 text-center font-bold uppercase text-xs italic">${c}</div>`).join('')}
                </div>
            </div>`;
        lucide.createIcons();
        const chat = document.getElementById('chat-container'); chat.scrollTop = chat.scrollHeight;
    }

    async function abrirPack() {
        const db = await fetchDB();
        const player = db.usuarios[userLogado];
        if (player.saldo < 5) return alert("Deposite via Cakto para abrir!");

        const cartas = ["Soldado MF", "Elite MF", "LENDÃRIA MF"];
        const sorteada = cartas[Math.floor(Math.random() * cartas.length)];
        player.saldo -= 5;
        player.cartas.push(sorteada);
        db.mensagens.push({ user: "SISTEMA", texto: `ðŸ”¥ ${userLogado.split('@')[0]} tirou um(a) ${sorteada}!` });
        await saveDB(db); render();
    }

    async function enviarMsg() {
        const input = document.getElementById('msg-input');
        if (!input.value.trim()) return;
        const db = await fetchDB();
        db.mensagens.push({ user: userLogado, texto: input.value });
        if (db.mensagens.length > 20) db.mensagens.shift();
        await saveDB(db); input.value = ""; render();
    }

    render();
    setInterval(render, 10000); // Atualiza chat a cada 10s
</script>
</body>
</html>
