<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MF-PAY | Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0b0e11; color: white; font-family: sans-serif; }
        input { background: #161a1e !important; border: 1px solid #232a31 !important; color: white !important; }
        .tab-active { color: #00e38c; border-bottom: 2px solid #00e38c; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen px-4">
    <div class="bg-[#161a1e] p-8 rounded-[40px] w-full max-w-sm border border-white/5 shadow-2xl">
        <h1 class="text-3xl font-black italic text-center mb-8 text-[#00e38c]">MF-PAY</h1>
        
        <div class="flex justify-center gap-6 mb-8 text-[10px] font-bold uppercase tracking-widest">
            <button id="t-login" onclick="setMode('login')" class="tab-active pb-2">Entrar</button>
            <button id="t-reg" onclick="setMode('reg')" class="text-zinc-500 pb-2">Cadastrar</button>
        </div>

        <div class="space-y-4">
            <input type="email" id="email" placeholder="Seu e-mail" class="w-full p-4 rounded-2xl outline-none">
            <input type="password" id="pin" placeholder="PIN de 6 dígitos" class="w-full p-4 rounded-2xl outline-none text-center font-bold tracking-widest">
            <button onclick="autenticar()" id="btn-auth" class="w-full py-5 bg-[#00e38c] text-black font-black rounded-2xl uppercase italic text-xs mt-4">Acessar Sistema</button>
        </div>
    </div>

<script>
    const DB_URL = "https://api.jsonbin.io/v3/b/65cd2a96dc74654018b36873";
    const KEY = "$2a$10$ExemploChaveMestreMFPAY2026";
    let mode = 'login';

    function setMode(m) {
        mode = m;
        document.getElementById('t-login').className = m === 'login' ? 'tab-active pb-2' : 'text-zinc-500 pb-2';
        document.getElementById('t-reg').className = m === 'reg' ? 'tab-active pb-2' : 'text-zinc-500 pb-2';
        document.getElementById('btn-auth').innerText = m === 'login' ? 'Acessar Sistema' : 'Criar Conta Agora';
    }

    async function autenticar() {
        const e = document.getElementById('email').value.trim().toLowerCase();
        const p = document.getElementById('pin').value.trim();
        if(!e || !p) return alert("Preencha tudo!");

        const btn = document.getElementById('btn-auth');
        btn.innerText = "SINCROZINANDO...";
        btn.disabled = true;

        try {
            const res = await fetch(DB_URL, { headers: { "X-Master-Key": KEY }});
            const data = await res.json();
            let db = data.record;

            if (mode === 'login') {
                if (db.usuarios[e] && db.usuarios[e].pin === p) {
                    localStorage.setItem('mf_user', e);
                    window.location.href = (e === 'admin@mf.com') ? 'admin.html' : 'index.html';
                } else { alert("E-mail ou PIN incorretos!"); }
            } else {
                if (db.usuarios[e]) { alert("E-mail já cadastrado!"); }
                else {
                    db.usuarios[e] = { saldo: 0, pin: p, historico: [] };
                    await fetch(DB_URL, {
                        method: 'PUT', headers: { "Content-Type": "application/json", "X-Master-Key": KEY },
                        body: JSON.stringify(db)
                    });
                    localStorage.setItem('mf_user', e);
                    window.location.href = 'index.html';
                }
            }
        } catch (err) { alert("Erro de conexão com o banco!"); }
        btn.disabled = false;
        btn.innerText = mode === 'login' ? 'Acessar Sistema' : 'Criar Conta Agora';
    }
</script>
</body>
</html>
