<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MF-COLLECT | Autenticação</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background: #0b0e11; color: #fff; font-family: 'Inter', sans-serif; overflow: hidden; }
        .login-card { 
            background: #161a1e; 
            border: 1px solid rgba(255,255,255,0.05); 
            border-radius: 40px; 
            box-shadow: 0 40px 100px rgba(0,0,0,0.8);
            position: relative;
        }
        .glow-bg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 300px; height: 300px; background: #00e38c; filter: blur(150px); opacity: 0.1; z-index: 0;
        }
        input { 
            background: #0b0e11 !important; 
            border: 1px solid #232a31 !important; 
            color: #fff !important; 
            outline: none; 
            transition: 0.3s; 
        }
        input:focus { border-color: #00e38c !important; box-shadow: 0 0 20px rgba(0, 227, 140, 0.1); }
        .btn-main { 
            background: #00e38c; color: #0b0e11; font-weight: 900; transition: 0.3s; 
            box-shadow: 0 10px 30px rgba(0, 227, 140, 0.2);
        }
        .btn-main:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(0, 227, 140, 0.4); }
    </style>
</head>
<body class="flex items-center justify-center h-screen px-4">

    <div class="glow-bg"></div>

    <div class="login-card p-12 w-full max-w-[420px] relative z-10">
        <div class="text-center mb-10">
            <div class="inline-flex p-4 bg-[#00e38c]/10 rounded-3xl mb-6">
                <i data-lucide="shield-check" class="text-[#00e38c] w-10 h-10"></i>
            </div>
            <h1 class="text-3xl font-black italic text-white tracking-tighter uppercase">MF<span class="text-[#00e38c]">-COLLECT</span></h1>
            <p class="text-[9px] text-zinc-500 uppercase tracking-[0.4em] font-bold mt-2">Acesso à Coleção Mundial</p>
        </div>
        
        <div class="space-y-5">
            <div>
                <label class="text-[9px] font-black uppercase text-zinc-600 ml-2 mb-2 block">Teu E-mail</label>
                <input type="email" id="email" placeholder="exemplo@gmail.com" class="w-full p-5 rounded-2xl text-sm">
            </div>
            <div>
                <label class="text-[9px] font-black uppercase text-zinc-600 ml-2 mb-2 block">PIN de Segurança</label>
                <input type="password" id="pass" placeholder="••••••" class="w-full p-5 rounded-2xl text-sm font-bold tracking-[0.5em]">
            </div>
        </div>

        <button onclick="entrar()" id="loginBtn" class="btn-main w-full py-5 rounded-2xl mt-10 uppercase text-xs tracking-widest italic flex items-center justify-center gap-2">
            ACEDER À CONTA <i data-lucide="arrow-right" class="w-4 h-4"></i>
        </button>

        <p class="text-center mt-8 text-[8px] text-zinc-700 font-bold uppercase tracking-widest">Servidores Encriptados</p>
    </div>

<script>
    lucide.createIcons();

    const AT_TOKEN = "patoycipIgoocXYWm.456e082a2c819a6b0afa041a2e670de54ee449bb6afe1c1f77075de45c51657c";
    const AT_BASE = "appnDadHY2h1sN6AI";

    async function entrar() {
        const e = document.getElementById('email').value.toLowerCase().trim();
        const p = document.getElementById('pass').value.trim();
        const b = document.getElementById('loginBtn');

        if(!e || !p) return alert("Preenche os campos!");

        b.innerText = "VERIFICANDO...";
        b.disabled = true;

        try {
            // Procura o utilizador
            const res = await fetch(`https://api.airtable.com/v0/${AT_BASE}/usuarios?filterByFormula={Merchant}='${e}'`, {
                headers: { "Authorization": `Bearer ${AT_TOKEN}` }
            });
            const data = await res.json();

            if (data.records && data.records.length > 0) {
                const user = data.records[0].fields;
                if (String(user.PIN) === p) {
                    localStorage.setItem('mf_user', e);
                    window.location.href = 'index.html';
                } else {
                    alert("PIN INCORRETO!");
                    resetBtn(b);
                }
            } else {
                // Se não existe, cria conta nova com R$ 0,00 de saldo
                await fetch(`https://api.airtable.com/v0/${AT_BASE}/usuarios`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${AT_TOKEN}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        records: [{ fields: { "Merchant": e, "PIN": p, "Saldo": 0, "Data": new Date().toLocaleString() } }]
                    })
                });
                localStorage.setItem('mf_user', e);
                window.location.href = 'index.html';
            }
        } catch (err) {
            alert("Erro de conexão.");
            resetBtn(b);
        }
    }

    function resetBtn(b) {
        b.innerText = "ACEDER À CONTA";
        b.disabled = false;
    }
</script>
</body>
</html>
