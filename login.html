<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MF-CLOUD | Autenticação</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background: #0b0e11; color: #fff; font-family: 'Inter', sans-serif; }
        .glass-card { background: #161a1e; border: 1px solid rgba(0, 227, 140, 0.1); border-radius: 40px; }
        input { background: #0b0e11 !important; border: 1px solid #232a31 !important; color: #fff !important; outline: none; }
        .btn-primary { background: #00e38c; color: #000; font-weight: 900; }
        .tab-active { color: #00e38c; border-bottom: 2px solid #00e38c; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen px-4">

    <div class="glass-card p-10 w-full max-w-[420px] shadow-2xl">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-black italic tracking-tighter uppercase">MF<span class="text-[#00e38c]">CLOUD</span></h1>
            <div class="flex justify-center gap-6 mt-6 text-[10px] font-black uppercase tracking-widest text-zinc-500">
                <button id="tab-login" onclick="switchTab('login')" class="pb-2 tab-active">Entrar</button>
                <button id="tab-register" onclick="switchTab('register')" class="pb-2">Cadastrar</button>
            </div>
        </div>
        
        <div class="space-y-5">
            <input type="email" id="email" placeholder="Seu e-mail" class="w-full p-4 rounded-2xl text-sm">
            <input type="password" id="pass" placeholder="PIN (Senha)" class="w-full p-4 rounded-2xl text-sm font-bold tracking-[0.5em]">
            
            <button onclick="autenticar()" id="mainBtn" class="btn-primary w-full py-5 rounded-2xl mt-4 uppercase text-xs tracking-widest italic">
                Entrar no Sistema
            </button>
        </div>
    </div>

<script>
    lucide.createIcons();
    
    // ESTE É O SEU BANCO DE DATA - VOU USAR UMA VERSÃO MAIS ESTÁVEL AGORA
    const CLOUD_DB_URL = "https://api.jsonbin.io/v3/b/65cd2a96dc74654018b36873"; 
    const MASTER_KEY = "$2a$10$ExemploChaveMestreMFPAY2026"; 
    
    let mode = 'login';

    function switchTab(newMode) {
        mode = newMode;
        document.getElementById('tab-login').classList.toggle('tab-active', mode === 'login');
        document.getElementById('tab-register').classList.toggle('tab-active', mode === 'register');
        document.getElementById('mainBtn').innerText = mode === 'login' ? 'Entrar no Sistema' : 'Criar Conta Grátis';
    }

    async function autenticar() {
        const e = document.getElementById('email').value.toLowerCase().trim();
        const p = document.getElementById('pass').value.trim();
        const btn = document.getElementById('mainBtn');

        if(!e || !p) return alert("Preencha os campos!");

        btn.innerText = "CARREGANDO...";
        btn.disabled = true;

        try {
            const res = await fetch(CLOUD_DB_URL, { headers: { "X-Master-Key": MASTER_KEY } });
            const json = await res.json();
            let db = json.record;

            // PROTEÇÃO: Se o banco estiver bugado ou vazio, inicializa ele
            if (!db || !db.usuarios) {
                db = { usuarios: {}, mensagens: [] };
            }

            if (mode === 'login') {
                if (db.usuarios[e] && db.usuarios[e].pin === p) {
                    localStorage.setItem('mf_user', e);
                    window.location.href = 'index.html';
                } else {
                    alert("E-mail ou PIN incorretos!");
                }
            } else {
                if (db.usuarios[e]) {
                    alert("E-mail já cadastrado!");
                } else {
                    db.usuarios[e] = { saldo: 0, pin: p, cartas: [] };
                    // SALVA O NOVO USUÁRIO NA NUVEM
                    await fetch(CLOUD_DB_URL, {
                        method: 'PUT',
                        headers: { "Content-Type": "application/json", "X-Master-Key": MASTER_KEY },
                        body: JSON.stringify(db)
                    });
                    localStorage.setItem('mf_user', e);
                    alert("Conta criada! Bem-vindo.");
                    window.location.href = 'index.html';
                }
            }
        } catch (err) {
            console.error(err);
            alert("Erro ao conectar com a nuvem. Verifique sua internet.");
        } finally {
            btn.disabled = false;
            btn.innerText = mode === 'login' ? 'Entrar no Sistema' : 'Criar Conta Grátis';
        }
    }
</script>
</body>
</html>
