<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Radar | MF</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white p-6 md:p-12">
    <header class="flex flex-col lg:flex-row justify-between mb-16 gap-8 items-center text-center md:text-left">
        <div>
            <h1 class="text-6xl font-black italic text-[#80ff44]">MASTER RADAR</h1>
            <p class="text-[10px] opacity-20 uppercase font-black tracking-widest mt-2">Central de Inteligência MF</p>
        </div>
        <div class="bg-[#0a0a0a] p-6 rounded-[40px] border border-white/5 flex gap-4 flex-wrap justify-center">
            <input type="text" id="ne" placeholder="Novo Email" class="bg-black border border-white/10 p-4 rounded-xl text-[10px] outline-none">
            <input type="password" id="np" placeholder="Nova Senha" class="bg-black border border-white/10 p-4 rounded-xl text-[10px] outline-none">
            <button onclick="saveA()" class="bg-[#80ff44] text-black px-8 py-4 rounded-xl font-black text-[10px] uppercase">Trocar Acesso</button>
            <button onclick="panic()" class="bg-red-600 px-8 py-4 rounded-xl font-black text-[10px] uppercase">Pânico</button>
        </div>
    </header>

    <div class="mb-10 bg-[#050505] p-8 rounded-[40px] border border-white/5">
        <p class="text-[10px] font-black text-red-600 animate-pulse mb-4 uppercase">Monitor de Atividade (Rastreio MF)</p>
        <div id="logs" class="font-mono text-[9px] opacity-40 space-y-2 max-h-32 overflow-y-auto"></div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
        <div class="bg-[#0a0a0a] p-12 rounded-[60px] border-l-8 border-[#80ff44] shadow-2xl">
            <p class="text-[10px] opacity-40 font-black mb-2 uppercase">Faturamento Líquido</p>
            <h2 id="fat" class="text-6xl font-black italic">R$ 0,00</h2>
        </div>
    </div>

    <div id="fila" class="grid grid-cols-1 lg:grid-cols-2 gap-8"></div>

    <div id="m" onclick="this.style.display='none'" class="fixed inset-0 bg-black/98 hidden z-50 flex items-center justify-center p-10">
        <img id="img-m" src="" class="max-w-full max-h-full rounded-3xl border border-white/5 shadow-2xl">
    </div>

    <script>
        const API = 'https://sheetdb.io/api/v1/n1iq28pv28d009pq';

        function saveA() {
            if(prompt("SENHA DE SEGURANÇA MF:") === '123') {
                localStorage.setItem('master_email', document.getElementById('ne').value);
                localStorage.setItem('master_pass', document.getElementById('np').value);
                alert("TRONO ATUALIZADO!"); location.reload();
            }
        }

        function possess(m) {
            sessionStorage.setItem('mf_auth', btoa('user'));
            sessionStorage.setItem('mf_user', m);
            window.open('painel.html', '_blank');
        }

        function panic() { localStorage.setItem('mf_panico', localStorage.getItem('mf_panico') !== 'true'); alert("REDE ALTERADA"); }

        async function monitor() {
            try {
                const res = await fetch(API); const d = await res.json();
                document.getElementById('fat').innerText = `R$ ${d.filter(i => i.status === 'Aprovado' && i.tipo === 'DEPOSITO').reduce((a, b) => a + parseFloat(b.valor || 0), 0).toLocaleString('pt-BR')}`;
                
                const lg = d.filter(i => i.tipo === 'LOG_ATIVIDADE').reverse().slice(0, 8);
                document.getElementById('logs').innerHTML = lg.map(l => `<p class="border-b border-white/5 pb-1"><span class="text-[#80ff44]">[${l.merchant}]</span> ${l.data_hora}</p>`).join('');

                const fl = d.filter(i => i.status === 'Pendente' || i.status === 'Aberto');
                document.getElementById('fila').innerHTML = fl.map(p => `
                    <div class="bg-[#0a0a0a] p-10 rounded-[50px] border border-white/5 flex flex-col md:flex-row justify-between items-center gap-6 shadow-2xl">
                        <div>
                            <p class="text-[9px] font-black text-[#80ff44] uppercase">${p.merchant} | ${p.tipo}</p>
                            <h3 class="text-3xl font-black italic">R$ ${p.valor}</h3>
                            ${p.comprovante ? `<button onclick="ver('${p.comprovante}')" class="text-blue-400 text-[10px] font-bold underline mt-2 uppercase">Ver Foto</button>` : `<p class="text-[10px] opacity-40 mt-1">${p.data_hora}</p>`}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="possess('${p.merchant}')" class="bg-zinc-900 text-[9px] px-6 py-4 rounded-2xl font-black uppercase">Possuir Conta</button>
                            <button onclick="ok('${p.id}')" class="bg-white text-black text-[9px] px-8 py-4 rounded-2xl font-black uppercase">Aprovar</button>
                        </div>
                    </div>
                `).join('');
            } catch(e) {}
        }

        function ver(s) { document.getElementById('img-m').src = s; document.getElementById('m').style.display = 'flex'; }
        async function ok(id) { await fetch(`${API}/id/${id}`, { method: 'PATCH', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ data: { status: 'Aprovado' } }) }); monitor(); }
        
        setInterval(monitor, 7000); monitor();
    </script>
</body>
</html>
