<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MFpay | MASTER CLOUD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050505; color: #fff; font-family: 'Inter', sans-serif; }
        .main-content { padding: 60px; max-width: 1200px; margin: auto; }
        .admin-card { background: #0d0d0d; border: 1px solid #1a1a1a; border-radius: 20px; padding: 30px; margin-bottom: 20px; }
    </style>
</head>
<body>

    <main class="main-content">
        <h1 class="text-4xl font-black italic text-[#80ff44] mb-12 uppercase tracking-tighter">MFpay Master Command</h1>
        
        <div id="fila-operacoes" class="space-y-4">
            <p class="text-gray-500 font-black italic">CONECTANDO AO BANCO DE DADOS...</p>
        </div>
    </main>

<script>
    const API = "https://sheetdb.io/api/v1/n1iq28pv28d009pq";

    async function carregarFila() {
        const res = await fetch(`${API}/search?status=Pendente`);
        const dados = await res.json();
        const l = document.getElementById('fila-operacoes');
        
        if(dados.length === 0) {
            l.innerHTML = '<p class="text-gray-800 font-black uppercase italic text-center p-20">Nenhuma pendência na planilha.</p>';
            return;
        }

        l.innerHTML = dados.map(i => `
            <div class="admin-card flex justify-between items-center">
                <div>
                    <h3 class="font-black italic text-xl uppercase">${i.merchant}</h3>
                    <p class="text-gray-600 text-xs">${i.tipo} • ${i.chave_pix || 'Sem chave'}</p>
                    <p class="text-[#80ff44] font-mono text-[10px] mt-2">${i.data_hora}</p>
                </div>
                <div class="text-right">
                    <h2 class="text-3xl font-black italic">R$ ${i.valor}</h2>
                    <div class="mt-4 space-x-4">
                        <button onclick="decidir('${i.id}', 'Aprovado')" class="bg-[#80ff44] text-black px-8 py-2 rounded-lg font-black italic">APROVAR</button>
                        <button onclick="decidir('${i.id}', 'Recusado')" class="text-red-500 font-black text-xs">RECUSAR</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    async function decidir(id, status) {
        // ATUALIZA NA PLANILHA VIA API
        const res = await fetch(`${API}/id/${id}`, {
            method: 'PATCH',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ data: { status: status } })
        });

        if(res.ok) {
            alert(`Operação ${status}!`);
            carregarFila();
        }
    }

    setInterval(carregarFila, 5000);
    carregarFila();
</script>
</body>
</html>
