<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MF PAY | MASTER ADMIN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050505; color: #fff; font-family: 'Inter', sans-serif; }
        .sidebar { background: #0a0a0a; height: 100vh; position: fixed; width: 260px; border-right: 1px solid #111; }
        .main-content { margin-left: 260px; padding: 40px; }
        .admin-card { background: #0f0f0f; border: 1px solid #1a1a1a; border-radius: 20px; }
        .nav-btn { width: 100%; text-align: left; padding: 15px 30px; font-size: 11px; font-weight: 800; color: #444; text-transform: uppercase; }
        .nav-btn.active { color: #80ff44; border-right: 4px solid #80ff44; }
        .btn-apr { background: #80ff44; color: #000; font-weight: 900; }
    </style>
</head>
<body>

    <aside class="sidebar py-10 flex flex-col justify-between">
        <div>
            <h1 class="text-center text-xl font-black italic text-[#80ff44] mb-12 italic uppercase tracking-tighter">MF PAY ADMIN</h1>
            <nav class="space-y-1">
                <button onclick="openTab('fila')" id="btn-fila" class="nav-btn active">Fila Ativa</button>
                <button onclick="openTab('mensagens')" id="btn-msg" class="nav-btn">Mensagens</button>
            </nav>
        </div>
        <div class="px-8 space-y-4">
            <button onclick="toggleLockdown()" id="lockBtn" class="w-full py-4 rounded-xl font-black text-[10px] uppercase italic"></button>
        </div>
    </aside>

    <main class="main-content">
        <div id="fila" class="tab-content">
            <div class="flex justify-between items-end mb-10">
                <h2 class="text-4xl font-black italic uppercase">Fila de Operações</h2>
                <div class="text-right">
                    <p class="text-[9px] font-bold text-gray-600 uppercase">Volume em Espera</p>
                    <h3 id="vol-esp" class="text-2xl font-black italic">R$ 0,00</h3>
                </div>
            </div>
            <div class="admin-card overflow-hidden">
                <table class="w-full text-left text-xs">
                    <thead class="bg-black/40 font-black uppercase text-gray-600 tracking-widest">
                        <tr><th class="p-6">Merchant</th><th class="p-6">Tipo</th><th class="p-6">Valor</th><th class="p-6">Ações</th></tr>
                    </thead>
                    <tbody id="lista-pedidos"></tbody>
                </table>
            </div>
        </div>
    </main>

    <audio id="audio-cash" src="https://www.myinstants.com/media/sounds/cash-register-purchase.mp3"></audio>

<script>
    let ultimoPedido = null;

    function toggleLockdown() {
        const s = localStorage.getItem('mf_lockdown') === 'true';
        localStorage.setItem('mf_lockdown', !s);
    }

    function decidir(acao) {
        const ped = JSON.parse(localStorage.getItem('mf_ped'));
        if(!ped) return;

        const hist = JSON.parse(localStorage.getItem('hist_' + ped.user) || '[]');
        if (hist.length > 0) {
            hist[hist.length - 1].status = (acao === 'APR') ? 'Aprovado' : 'Recusado';
            localStorage.setItem('hist_' + ped.user, JSON.stringify(hist));
        }

        if (acao === 'APR') {
            const current = parseFloat(localStorage.getItem('bal_'+ped.user) || 0);
            localStorage.setItem('bal_'+ped.user, (ped.tipo === 'DEP' ? current + parseFloat(ped.valor) : current - parseFloat(ped.valor)).toFixed(2));
            document.getElementById('audio-cash').play();
        }

        localStorage.removeItem('mf_ped');
        renderPedidos();
    }

    function renderPedidos() {
        const lista = document.getElementById('lista-pedidos');
        const ped = JSON.parse(localStorage.getItem('mf_ped'));
        lista.innerHTML = ped ? '' : '<tr><td colspan="4" class="p-20 text-center font-bold text-gray-800 uppercase italic">Rede em Repouso</td></tr>';
        
        if(ped) {
            if(!ultimoPedido || ultimoPedido.timestamp !== ped.timestamp) {
                document.getElementById('audio-cash').play(); // Som ao entrar pedido novo
                ultimoPedido = ped;
            }
            document.getElementById('vol-esp').innerText = `R$ ${parseFloat(ped.valor).toLocaleString('pt-BR')}`;
            lista.innerHTML = `<tr class="border-t border-white/5">
                <td class="p-6 font-black italic uppercase">${ped.user}</td>
                <td class="p-6 font-bold uppercase text-[10px]">${ped.tipo}</td>
                <td class="p-6 text-[#80ff44] font-black italic text-lg">R$ ${parseFloat(ped.valor).toLocaleString('pt-BR')}</td>
                <td class="p-6 space-x-2">
                    <button onclick="decidir('APR')" class="btn-apr px-4 py-2 rounded-lg text-[9px] uppercase">Aprovar</button>
                    <button onclick="decidir('REC')" class="bg-red-600 px-4 py-2 rounded-lg text-[9px] font-black uppercase italic">Negar</button>
                </td>
            </tr>`;
        }
    }

    setInterval(() => {
        const s = localStorage.getItem('mf_lockdown') === 'true';
        document.getElementById('lockBtn').innerText = s ? "DESTRAVAR GATEWAY" : "LOCKDOWN GLOBAL";
        document.getElementById('lockBtn').style.background = s ? "#ef4444" : "#1a1a1a";
        renderPedidos();
    }, 1500);
</script>
</body>
</html>
