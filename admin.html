<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MFpay | MASTER COMMAND</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050505; color: #fff; font-family: 'Inter', sans-serif; }
        .sidebar { background: #080808; height: 100vh; position: fixed; width: 280px; border-right: 1px solid #111; }
        .main-content { margin-left: 280px; padding: 40px; }
        .admin-card { background: #0d0d0d; border: 1px solid #1a1a1a; border-radius: 20px; }
        .nav-btn { width: 100%; text-align: left; padding: 18px 30px; font-size: 11px; font-weight: 900; color: #333; text-transform: uppercase; border-right: 4px solid transparent; italic; }
        .nav-btn.active { color: #80ff44; border-right-color: #80ff44; background: linear-gradient(90deg, transparent, rgba(128,255,68,0.02)); }
        .alerta-risco { animation: pulseRed 1s infinite; border: 1px solid red !important; }
        @keyframes pulseRed { 0% { background: #0d0d0d; } 50% { background: #400000; } 100% { background: #0d0d0d; } }
        .log-info { color: #555; } .log-alerta { color: #ffaa00; font-weight: bold; } .log-critico { color: #ff4444; font-weight: 900; background: #200; }
    </style>
</head>
<body>

    <aside class="sidebar py-10 flex flex-col justify-between text-center">
        <div class="px-10 mb-12"><h1 class="text-xl font-black italic text-[#80ff44] uppercase">MFpay MASTER</h1></div>
        <nav class="space-y-1">
            <button onclick="tab('fila')" class="nav-btn active">Fila Real-Time</button>
            <button onclick="tab('auditoria')" class="nav-btn">Monitor de Risco</button>
        </nav>
        <div class="px-8"><button onclick="toggleLockdown()" id="lockBtn" class="w-full py-4 rounded-xl font-black text-[10px] uppercase italic"></button></div>
    </aside>

    <main class="main-content">
        <div id="fila" class="tab-sec">
            <h2 class="text-4xl font-black italic uppercase italic mb-10">Monitor de Operações</h2>
            <div id="lista-pedidos" class="space-y-4"></div>
        </div>

        <div id="auditoria" class="tab-sec hidden">
            <h2 class="text-4xl font-black italic uppercase mb-8">Logs de Segurança</h2>
            <div class="admin-card p-10 h-[500px] overflow-y-auto space-y-2 text-[10px]" id="container-logs"></div>
        </div>
    </main>

    <audio id="snd" src="https://www.myinstants.com/media/sounds/cash-register-purchase.mp3"></audio>

<script>
    let ultimoId = null;
    function tab(t) {
        document.querySelectorAll('.tab-sec').forEach(x => x.classList.add('hidden'));
        document.getElementById(t).classList.remove('hidden');
    }

    function renderPedidos() {
        const ped = JSON.parse(localStorage.getItem('mf_ped'));
        const l = document.getElementById('lista-pedidos');
        if(!ped) { l.innerHTML = '<p class="text-gray-800 font-black italic uppercase">Vigilância Estável...</p>'; return; }
        
        if(ped.timestamp !== ultimoId) { document.getElementById('snd').play(); ultimoId = ped.timestamp; }
        
        let rClass = ped.risco === 'ALTO' ? 'alerta-risco' : '';
        let rText = ped.risco === 'ALTO' ? '<span class="text-red-500 font-black blink uppercase ml-4">[RISCO DETECTADO]</span>' : '';

        l.innerHTML = `
            <div class="admin-card p-10 flex justify-between items-center ${rClass}">
                <div>
                    <h3 class="font-black italic text-xl uppercase">${ped.user} ${rText}</h3>
                    <p class="text-[10px] text-gray-500 uppercase">${ped.tipo} • ID: ${ped.timestamp}</p>
                </div>
                <div class="text-right">
                    <h2 class="text-4xl font-black italic text-[#80ff44]">R$ ${ped.valor}</h2>
                    <button onclick="decidir('APR')" class="mt-4 bg-[#80ff44] text-black px-10 py-3 rounded-xl font-black uppercase italic">Validar Operação</button>
                </div>
            </div>`;
    }

    function decidir(acao) {
        const ped = JSON.parse(localStorage.getItem('mf_ped'));
        const cur = parseFloat(localStorage.getItem('bal_'+ped.user) || 0);
        localStorage.setItem('bal_'+ped.user, (cur + parseFloat(ped.valor)).toFixed(2));
        localStorage.removeItem('mf_ped'); renderPedidos();
    }

    setInterval(() => {
        // RENDER LOGS COM CORES DE RISCO
        const logs = JSON.parse(localStorage.getItem('mf_logs_master') || '[]');
        document.getElementById('container-logs').innerHTML = logs.map(l => `
            <div class="p-2 border-b border-white/5 ${l.nivel === 'CRÍTICO' ? 'log-critico' : (l.nivel === 'ALTO RISCO' ? 'log-alerta' : 'log-info')}">
                [${l.data}] [${l.nivel}] ${l.user}: ${l.acao}
            </div>`).join('');

        renderPedidos();
        const s = localStorage.getItem('mf_lockdown') === 'true';
        document.getElementById('lockBtn').innerText = s ? "LIBERAR" : "LOCKDOWN";
    }, 1500);
</script>
</body>
</html>
