<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MFpay | Dashboard Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background: #0b0e11; color: #fff; font-family: 'Inter', sans-serif; }
        .sidebar { background: #111418; border-right: 1px solid #1c2127; height: 100vh; position: fixed; width: 260px; padding: 40px 25px; }
        .main { margin-left: 260px; padding: 40px 60px; }
        .card-mf { background: #161a1e; border: 1px solid #232a31; border-radius: 24px; padding: 25px; position: relative; }
        .progress-bg { background: #1c2127; height: 10px; border-radius: 10px; overflow: hidden; }
        .progress-fill { background: linear-gradient(90deg, #00e38c, #00c479); height: 100%; transition: 1.5s ease-in-out; }
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 9px; font-weight: 900; text-transform: uppercase; }
        .input-mf { background: #0b0e11; border: 1px solid #232a31; color: #fff; border-radius: 14px; padding: 16px; width: 100%; outline: none; }
    </style>
</head>
<body>

    <aside class="sidebar flex flex-col">
        <div class="flex items-center gap-3 mb-16 px-2">
            <i data-lucide="zap" class="text-[#00e38c] w-8 h-8"></i>
            <h1 class="text-[#00e38c] font-black italic text-2xl tracking-tighter">MFPAY</h1>
        </div>
        <nav class="flex-1 space-y-2">
            <div class="flex items-center gap-3 text-[#00e38c] bg-[#1c2127] p-4 rounded-xl text-xs font-bold cursor-pointer italic">
                <i data-lucide="layout-dashboard" class="w-4 h-4"></i> FINANCEIRO
            </div>
            <div id="mestre-box" class="hidden pt-10 border-t border-zinc-900 text-center">
                <p class="text-[9px] font-black text-blue-500 mb-4 tracking-widest uppercase">Console Admin</p>
                <button onclick="toggleMt()" id="btn-mt" class="w-full py-3 border border-blue-900 text-blue-500 rounded-xl text-[10px] font-black hover:bg-blue-900/10">SISTEMA ONLINE</button>
            </div>
        </nav>
        <div onclick="logout()" class="flex items-center gap-3 text-red-900 p-4 text-xs font-bold cursor-pointer mt-auto tracking-widest"><i data-lucide="log-out" class="w-4 h-4"></i> SAIR</div>
    </aside>

    <main class="main">
        <div class="card-mf mb-8 border-[#00e38c]/10">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-2 text-zinc-500 font-black text-[9px] tracking-widest uppercase">
                    <i data-lucide="trending-up" class="text-[#00e38c] w-4 h-4"></i> Faturamento Total
                </div>
                <span id="perc-txt" class="text-[#00e38c] font-black italic text-xs">0%</span>
            </div>
            <div class="progress-bg mb-2"><div id="perc-bar" class="progress-fill" style="width: 0%"></div></div>
            <p class="text-[9px] text-zinc-600 font-bold uppercase tracking-tighter italic">Acumulado: <span id="fat-txt" class="text-white">R$ 0,00</span> / R$ 10.000,00</p>
        </div>

        <div class="grid grid-cols-2 gap-8 mb-8">
            <div class="card-mf border-l-4 border-l-[#00e38c]">
                <p class="text-zinc-500 text-[10px] font-black uppercase mb-2">Saldo em Conta <i data-lucide="lock" class="inline w-3 h-3 ml-1"></i></p>
                <h3 id="saldo-txt" class="text-4xl font-black italic tracking-tighter">R$ 0,00</h3>
            </div>
            <div id="premio-card" class="card-mf opacity-20 grayscale flex items-center gap-5 transition-all duration-1000">
                <div class="p-4 bg-yellow-500/10 rounded-2xl"><i data-lucide="award" class="text-yellow-500 w-8 h-8"></i></div>
                <div>
                    <h4 class="text-xs font-black italic uppercase">Award 10K</h4>
                    <p id="premio-status" class="text-[9px] text-zinc-600 font-black uppercase">Bloqueado</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-10 mb-10">
            <div class="card-mf bg-[#111418]">
                <h4 class="text-[10px] font-black text-[#00e38c] mb-6 uppercase tracking-widest italic">Lançar Crédito</h4>
                <input type="number" id="v-in" placeholder="0.00" class="input-mf text-2xl font-black mb-6">
                <button onclick="operar('DEPOSITO')" class="w-full bg-[#00e38c] text-black font-black py-4 rounded-xl uppercase text-[10px] italic">Confirmar Crédito</button>
            </div>
            <div class="card-mf bg-[#111418]">
                <h4 class="text-[10px] font-black text-red-500 mb-6 uppercase tracking-widest italic">Solicitar Saque</h4>
                <input type="text" id="pix-key" placeholder="Chave Pix" class="input-mf mb-2">
                <input type="number" id="v-out" placeholder="0.00" class="input-mf mb-6">
                <button onclick="operar('SAQUE')" class="w-full bg-zinc-800 text-white font-black py-4 rounded-xl uppercase text-[10px] italic">Solicitar Resgate</button>
            </div>
        </div>

        <div class="card-mf border-zinc-900 p-0 overflow-hidden">
            <div class="p-5 border-b border-zinc-900"><h4 class="text-[10px] font-black uppercase text-zinc-500 tracking-widest">Últimas Transações</h4></div>
            <table class="w-full text-left text-xs">
                <tbody id="lista-transacoes" class="divide-y divide-zinc-900/50"></tbody>
            </table>
        </div>
        
        <footer class="mt-16 pb-10 text-center opacity-20"><p class="text-[9px] font-black tracking-[0.5em] text-zinc-600 uppercase">MFPAY SECURE NETWORK v2.6</p></footer>
    </main>

<script>
    lucide.createIcons();
    const API = "https://sheetdb.io/api/v1/n1iq28pv28d009pq";
    const user = localStorage.getItem('mf_user');
    const MESTRE = "zndohot@gmail.com"; 

    if(!user) window.location.href = 'index.html';
    
    // ATIVAÇÃO MESTRE
    if(user === MESTRE) document.getElementById('mestre-box').classList.remove('hidden');

    async function sync() {
        try {
            // BLOQUEIO DE REDE (SÓ O MESTRE PASSA)
            const m_res = await fetch(`${API}/search?merchant=${MESTRE}&tipo=CONTROLE`);
            const m_data = await m_res.json();
            if(m_data.length > 0 && m_data[0].status === 'MANUTENCAO' && user !== MESTRE) {
                document.body.innerHTML = "<div style='height:100vh;display:flex;align-items:center;justify-content:center;background:#000;color:#00e38c;font-family:sans-serif;font-weight:900;font-style:italic;font-size:3rem;'>MFPAY_SYSTEM_OFFLINE</div>";
                return;
            }
            if(m_data.length > 0 && m_data[0].status === 'MANUTENCAO') {
                const b = document.getElementById('btn-mt'); b.innerText = "MANUTENÇÃO ATIVA"; b.style.color = "#ef4444";
            }

            // CARREGAR DADOS DO MERCHANT
            const res = await fetch(`${API}/search?merchant=${user}`);
            const data = await res.json();
            let saldo = 0, fat = 0, html = "";

            data.reverse().slice(0, 5).forEach(i => {
                const isOut = i.tipo === 'SAQUE';
                const sColor = i.status === 'Aprovado' ? 'text-green-500 bg-green-500/10' : 'text-yellow-500 bg-yellow-500/10';
                html += `<tr class="hover:bg-white/5"><td class="p-4 font-bold">${i.tipo}</td><td class="p-4 text-zinc-500">${i.data_hora}</td><td class="p-4 font-black ${isOut?'text-red-500':'text-green-500'}">R$ ${i.valor}</td><td class="p-4 text-right"><span class="badge ${sColor}">${i.status}</span></td></tr>`;
                
                if(i.status === 'Aprovado') {
                    const v = parseFloat(i.valor);
                    if(i.tipo === 'DEPOSITO') { saldo += v; fat += v; }
                    if(i.tipo === 'SAQUE') saldo -= v;
                }
            });

            document.getElementById('lista-transacoes').innerHTML = html;
            document.getElementById('saldo-txt').innerText = `R$ ${saldo.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('fat-txt').innerText = `R$ ${fat.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            
            const p = Math.min((fat / 10000) * 100, 100);
            document.getElementById('perc-bar').style.width = p + "%";
            document.getElementById('perc-txt').innerText = Math.floor(p) + "%";

            if(fat >= 10000) {
                const c = document.getElementById('premio-card');
                c.classList.remove('opacity-20', 'grayscale');
                c.classList.add('border-yellow-500/40', 'bg-yellow-500/5');
                document.getElementById('premio-status').innerText = "CONQUISTADO";
                document.getElementById('premio-status').style.color = "#eab308";
            }
        } catch(e) {}
    }

    async function operar(t) {
        const v = t === 'DEPOSITO' ? document.getElementById('v-in').value : document.getElementById('v-out').value;
        const pix = t === 'SAQUE' ? document.getElementById('pix-key').value : "";
        if(!v || v <= 0) return alert("Valor inválido");

        await fetch(API, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ data: [{ id: t+"-"+Date.now(), merchant: user, tipo: t, valor: v, status: t==='DEPOSITO'?'Aprovado':'Pendente', data_hora: new Date().toLocaleString(), observacao: pix }]})
        });
        location.reload();
    }

    async function toggleMt() {
        const senha = prompt("SENHA MESTRE:");
        if(senha === "123") {
            const btn = document.getElementById('btn-mt');
            const s = btn.innerText.includes("ONLINE") ? "MANUTENCAO" : "ONLINE";
            await fetch(`${API}/merchant/${MESTRE}`, {
                method: 'PATCH',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ data: { status: s, tipo: 'CONTROLE' } })
            });
            location.reload();
        } else { alert("NEGADO"); }
    }

    function logout() { localStorage.clear(); window.location.href = 'index.html'; }
    sync(); setInterval(sync, 15000);
</script>
</body>
</html>
