<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MFpay | Dashboard Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background: #0b0e11; color: #fff; font-family: 'Inter', sans-serif; }
        .sidebar { background: #111418; border-right: 1px solid #1c2127; height: 100vh; position: fixed; width: 260px; padding: 40px 25px; }
        .main { margin-left: 260px; padding: 40px 60px; }
        .card-mf { background: #161a1e; border: 1px solid #232a31; border-radius: 24px; padding: 25px; position: relative; }
        .progress-bg { background: #1c2127; height: 10px; border-radius: 10px; overflow: hidden; }
        .progress-fill { background: linear-gradient(90deg, #00e38c, #00c479); height: 100%; transition: 1.5s ease-in-out; }
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 9px; font-weight: 900; text-transform: uppercase; }
        .input-mf { background: #0b0e11; border: 1px solid #232a31; color: #fff; border-radius: 12px; padding: 14px; width: 100%; outline: none; }
    </style>
</head>
<body>

    <aside class="sidebar flex flex-col">
        <div class="flex items-center gap-3 mb-12 px-2">
            <i data-lucide="zap" class="text-[#00e38c] w-8 h-8"></i>
            <h1 class="text-[#00e38c] font-black italic text-2xl tracking-tighter">MFPAY</h1>
        </div>
        <nav class="flex-1 space-y-2">
            <div class="flex items-center gap-3 text-[#00e38c] bg-[#1c2127] p-4 rounded-xl text-xs font-bold cursor-pointer">
                <i data-lucide="layout-dashboard" class="w-4 h-4"></i> FINANCEIRO
            </div>
            <div id="mestre-box" class="hidden pt-6 border-t border-zinc-900">
                <button onclick="toggleMt()" id="btn-mt" class="w-full py-2 border border-blue-900 text-blue-500 rounded-lg text-[10px] font-black">SISTEMA ONLINE</button>
            </div>
        </nav>
        <div onclick="logout()" class="flex items-center gap-3 text-red-900 p-4 text-xs font-bold cursor-pointer mt-auto">
            <i data-lucide="log-out" class="w-4 h-4"></i> SAIR
        </div>
    </aside>

    <main class="main">
        <div class="card-mf mb-8 border-[#00e38c]/10">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-2 text-zinc-500 font-black text-[9px] tracking-widest uppercase">
                    <i data-lucide="trending-up" class="text-[#00e38c] w-4 h-4"></i> Performance de Faturamento
                </div>
                <span id="perc-txt" class="text-[#00e38c] font-black italic text-xs">0%</span>
            </div>
            <div class="progress-bg mb-2"><div id="perc-bar" class="progress-fill" style="width: 0%"></div></div>
            <p class="text-[9px] text-zinc-600 font-bold uppercase">Volume: <span id="fat-txt" class="text-white">R$ 0,00</span> / R$ 10.000,00</p>
        </div>

        <div class="grid grid-cols-2 gap-8 mb-8">
            <div class="card-mf border-l-4 border-l-[#00e38c]">
                <p class="text-zinc-500 text-[10px] font-black uppercase mb-2">Saldo Protegido <i data-lucide="lock" class="inline w-3 h-3 ml-1"></i></p>
                <h3 id="saldo-txt" class="text-4xl font-black italic tracking-tighter">R$ 0,00</h3>
            </div>
            <div id="premio-card" class="card-mf border-zinc-800 flex items-center gap-4 opacity-20 grayscale transition-all duration-700">
                <div class="w-12 h-12 rounded-full bg-yellow-500/10 flex items-center justify-center">
                    <i data-lucide="award" class="text-yellow-500 w-7 h-7"></i>
                </div>
                <div>
                    <h4 class="text-xs font-black italic">PRÊMIO 10K</h4>
                    <p class="text-[9px] text-zinc-500 uppercase font-black" id="premio-status">Bloqueado</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-10 mb-10">
            <div class="card-mf bg-[#111418]">
                <h4 class="text-[10px] font-black text-[#00e38c] mb-6 uppercase italic">Lançar Crédito</h4>
                <input type="number" id="v-in" placeholder="Valor R$" class="input-mf text-2xl font-black mb-6">
                <button onclick="operar('DEPOSITO')" class="w-full bg-[#00e38c] text-black font-black py-4 rounded-xl uppercase text-[10px] italic shadow-lg shadow-[#00e38c]/10">Confirmar Aporte</button>
            </div>
            <div class="card-mf bg-[#111418]">
                <h4 class="text-[10px] font-black text-red-500 mb-6 uppercase italic">Solicitar Resgate</h4>
                <input type="text" id="pix-key" placeholder="Chave Pix" class="input-mf mb-4">
                <input type="number" id="v-out" placeholder="Valor R$" class="input-mf mb-6">
                <button onclick="operar('SAQUE')" class="w-full bg-zinc-800 text-white font-black py-4 rounded-xl uppercase text-[10px] italic">Solicitar Saque</button>
            </div>
        </div>

        <div class="card-mf border-zinc-900 p-0 overflow-hidden">
            <div class="p-5 border-b border-zinc-900"><h4 class="text-[10px] font-black uppercase text-zinc-500">Últimas Atividades</h4></div>
            <table class="w-full text-left text-xs">
                <tbody id="lista-transacoes" class="divide-y divide-zinc-900/50"></tbody>
            </table>
        </div>
    </main>

<script>
    lucide.createIcons();
    const API = "https://sheetdb.io/api/v1/n1iq28pv28d009pq";
    const user = localStorage.getItem('mf_user');
    const MESTRE = "zndohot@gmail.com";

    if(!user) window.location.href = 'index.html';
    if(user === MESTRE) document.getElementById('mestre-box').classList.remove('hidden');

    async function atualizar() {
        try {
            const res = await fetch(`${API}/search?merchant=${user}`);
            const data = await res.json();
            let saldo = 0, fat = 0, html = "";

            data.reverse().slice(0, 5).forEach(i => {
                const isOut = i.tipo === 'SAQUE';
                const statusColor = i.status === 'Aprovado' ? 'bg-green-500/10 text-green-500' : 'bg-yellow-500/10 text-yellow-500';
                html += `<tr><td class="p-4 font-bold uppercase">${i.tipo}</td><td class="p-4 text-zinc-500">${i.data_hora}</td><td class="p-4 font-black ${isOut?'text-red-500':'text-green-500'}">R$ ${i.valor}</td><td class="p-4 text-right"><span class="badge ${statusColor}">${i.status}</span></td></tr>`;
                
                if(i.status === 'Aprovado') {
                    const v = parseFloat(i.valor);
                    if(i.tipo === 'DEPOSITO') { saldo += v; fat += v; }
                    if(i.tipo === 'SAQUE') saldo -= v;
                }
            });

            document.getElementById('lista-transacoes').innerHTML = html;
            document.getElementById('saldo-txt').innerText = `R$ ${saldo.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('fat-txt').innerText = `R$ ${fat.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            
            const p = Math.min((fat / 10000) * 100, 100);
            document.getElementById('perc-bar').style.width = p + "%";
            document.getElementById('perc-txt').innerText = Math.floor(p) + "%";

            if(fat >= 10000) {
                const card = document.getElementById('premio-card');
                card.classList.remove('grayscale', 'opacity-20');
                card.classList.add('border-yellow-500/40', 'bg-yellow-500/5');
                document.getElementById('premio-status').innerText = "CONQUISTADO";
                document.getElementById('premio-status').style.color = "#eab308";
            }
        } catch(e) {}
    }

    async function operar(tipo) {
        const val = tipo === 'DEPOSITO' ? document.getElementById('v-in').value : document.getElementById('v-out').value;
        const pix = tipo === 'SAQUE' ? document.getElementById('pix-key').value : "";
        if(!val || val <= 0) return alert("Valor inválido");

        await fetch(API, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ data: [{ 
                id: tipo + "-" + Date.now(), merchant: user, tipo: tipo, valor: val, 
                status: tipo === 'DEPOSITO' ? 'Aprovado' : 'Pendente', 
                data_hora: new Date().toLocaleString(), observacao: pix 
            }]})
        });
        location.reload();
    }

    function logout() { localStorage.clear(); window.location.href = 'index.html'; }
    atualizar(); setInterval(atualizar, 15000);
</script>
</body>
</html>
