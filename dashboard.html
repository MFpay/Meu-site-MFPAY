<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MFpay | Dashboard Real-Time</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050505; color: #fff; font-family: 'Inter', sans-serif; }
        .sidebar { background: #080808; border-right: 1px solid #151515; height: 100vh; position: fixed; width: 260px; }
        .main-content { margin-left: 260px; padding: 40px; }
        .gateway-card { background: #0d0d0d; border-radius: 20px; border: 1px solid #1a1a1a; padding: 40px; }
        .nav-btn { width: 100%; text-align: left; padding: 18px 30px; font-size: 11px; font-weight: 800; text-transform: uppercase; color: #444; border-left: 4px solid transparent; }
        .nav-btn.active { color: #80ff44; border-left-color: #80ff44; background: #0f0f0f; }
        input, select { background: #000 !important; border: 1px solid #222 !important; border-radius: 12px; color: #fff; padding: 15px; width: 100%; outline: none; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>

    <aside class="sidebar py-10">
        <div class="px-10 mb-12"><h1 class="font-black italic text-2xl text-[#80ff44]">MFpay</h1></div>
        <nav>
            <button onclick="openTab('dash')" class="nav-btn active" id="btn-dash">Dashboard</button>
            <button onclick="openTab('extrato')" class="nav-btn" id="btn-extrato">Extrato</button>
            <button onclick="openTab('deposito')" class="nav-btn">Injetar</button>
            <button onclick="openTab('saque')" class="nav-btn text-[#80ff44]">Sacar</button>
        </nav>
    </aside>

    <main class="main-content">
        <div id="dash" class="tab-content active space-y-8">
            <h2 class="text-4xl font-black italic uppercase">Saldo MF</h2>
            <div class="gateway-card border-b-4 border-[#80ff44]">
                <p class="text-gray-600 text-[10px] font-bold uppercase mb-2">Disponível para Saque</p>
                <h2 id="bal" class="text-7xl font-black italic text-white tracking-tighter">R$ ---</h2>
            </div>
        </div>

        <div id="extrato" class="tab-content">
            <h2 class="text-4xl font-black italic uppercase mb-8">Histórico Cloud</h2>
            <div class="gateway-card p-0 overflow-hidden">
                <table class="w-full text-left text-xs">
                    <tbody id="lista-extrato"></tbody>
                </table>
            </div>
        </div>

        <div id="deposito" class="tab-content max-w-xl mx-auto space-y-6">
            <h2 class="text-3xl font-black italic uppercase text-center">Injetar Saldo</h2>
            <input type="number" id="val-dep" placeholder="Valor R$ 0,00">
            <button onclick="enviarParaBanco('DEPOSITO')" class="w-full bg-[#80ff44] text-black font-black py-5 rounded-xl italic">CONFIRMAR NO BANCO</button>
        </div>

        <div id="saque" class="tab-content max-w-xl mx-auto space-y-6">
            <h2 class="text-3xl font-black italic uppercase text-center">Liquidação Pix</h2>
            <input type="number" id="val-saq" placeholder="Valor R$ 0,00">
            <input type="text" id="pix-dest" placeholder="Chave Pix">
            <button onclick="enviarParaBanco('SAQUE')" class="w-full bg-[#80ff44] text-black font-black py-5 rounded-xl italic">SOLICITAR RESGATE</button>
        </div>
    </main>

<script>
    const API = "https://sheetdb.io/api/v1/n1iq28pv28d009pq";
    const user = "MF";

    function openTab(t) {
        document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
        document.getElementById(t).classList.add('active');
        if(t === 'extrato') carregarExtrato();
    }

    async function atualizarSaldo() {
        const res = await fetch(`${API}/search?merchant=${user}&status=Aprovado`);
        const dados = await res.json();
        let saldo = 0;
        dados.forEach(i => {
            if(i.tipo === 'DEPOSITO') saldo += parseFloat(i.valor);
            if(i.tipo === 'SAQUE') saldo -= parseFloat(i.valor);
        });
        document.getElementById('bal').innerText = `R$ ${saldo.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
    }

    async function carregarExtrato() {
        const res = await fetch(`${API}/search?merchant=${user}`);
        const dados = await res.json();
        document.getElementById('lista-extrato').innerHTML = dados.reverse().map(i => `
            <tr class="border-t border-white/5">
                <td class="p-6 font-mono text-gray-500">#${i.id}</td>
                <td class="p-6 font-black uppercase">${i.tipo}</td>
                <td class="p-6">R$ ${i.valor}</td>
                <td class="p-6 text-right font-black ${i.status === 'Aprovado' ? 'text-[#80ff44]' : 'text-yellow-500'}">${i.status}</td>
            </tr>
        `).join('');
    }

    async function enviarParaBanco(tipo) {
        const val = document.getElementById(tipo === 'DEPOSITO' ? 'val-dep' : 'val-saq').value;
        const chave = document.getElementById('pix-dest')?.value || '';
        
        if(!val || val <= 0) return alert("Valor inválido");

        const payload = {
            id: Date.now(),
            merchant: user,
            tipo: tipo,
            valor: val,
            status: 'Pendente',
            chave_pix: chave,
            data_hora: new Date().toLocaleString('pt-BR')
        };

        const res = await fetch(API, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ data: [payload] })
        });

        if(res.ok) {
            alert("Enviado para Nuvem MFpay!");
            location.reload();
        }
    }

    setInterval(atualizarSaldo, 5000);
    atualizarSaldo();
</script>
</body>
</html>

